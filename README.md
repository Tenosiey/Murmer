# Murmer

Murmer is a **self-hostable** minimal voice and text chat prototype built with Tauri and SvelteKit.

## Prerequisites
- [Rust](https://www.rust-lang.org/tools/install)
- [Node.js](https://nodejs.org) 22+
- [Tauri prerequisites](https://v2.tauri.app/start/prerequisites/)

## Architecture
The repository contains a Tauri/SvelteKit client and a Rust WebSocket server.
The client lives under `murmer_client/` while the server code is in
`murmer_server/`. The provided `docker-compose.yml` starts the server together
with Postgres.

## Running the client
```bash
cd murmer_client
npm install
npm run tauri dev
```
This launches the desktop app.

## Running the server
### Prerequisites
Docker is required to host the server.

Use Docker Compose to run the server together with Postgres:
```bash
docker compose up --build
```
The server exposes a WebSocket endpoint at `ws://localhost:3001/ws`. The client can store multiple server URLs and connect to any of them via the "Servers" screen. Added servers are persisted locally so favorites remain after restart.
The `DATABASE_URL` used by the server is defined in `docker-compose.yml`.
If you set the `SERVER_PASSWORD` environment variable in `docker-compose.yml`, the server will require clients to provide that password when connecting.

On first launch the server creates a single text channel named `general`. Users
can create additional channels as needed, but no other channels are included by
default.

### Admin Roles

The server can assign custom roles to users. To enable this feature set the `ADMIN_TOKEN`
environment variable when launching the server. You can add it to
`docker-compose.yml` or export it in your shell before running `cargo run`.
The value should be a **secret string** of your choice, for example:

```bash
export ADMIN_TOKEN=my-admin-token
```
The same token must be provided in requests to the `/role` endpoint.

Use the `/role` endpoint to change a user's role. Send a POST request with an
`Authorization: Bearer <ADMIN_TOKEN>` header and a JSON body containing the
user's public key and desired role:

```bash
curl -X POST http://localhost:3001/role \
     -H "Authorization: Bearer <ADMIN_TOKEN>" \
     -H "Content-Type: application/json" \
     -d '{"key":"<public-key>","role":"admin"}'
```

`<public-key>` is the base64 encoded Ed25519 public key generated by the client.
The next time that user connects, the server will send them a `role` message
indicating their assigned role.

### Image Uploads

Uploaded images are stored on disk under an `uploads/` directory. The `/upload` endpoint returns a relative path like `/files/<filename>` which clients combine with the server URL to load the image.

`docker-compose.yml` mounts a volume for the uploads directory so files persist between restarts.

## Docker
A `docker-compose.yml` runs the Rust server alongside Postgres. The client is run locally without Docker.

## Development
Run `npm run check` in `murmer_client` to lint Svelte and TypeScript sources.
Format the server code with `cargo fmt` before committing changes.

## Notes
This project is an early prototype demonstrating login, server selection, text chat and a stub for voice communication via WebRTC.
